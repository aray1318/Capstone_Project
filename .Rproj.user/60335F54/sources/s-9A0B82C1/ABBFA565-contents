---
title: "pga_tour"
author: "Andrew Raymond"
date: "6/6/2022"
output: html_document
---

## Loading the data

```{r}
library(tidyverse)
pga_data = read_csv("CopyOfpga_tour.csv")


pga_data = pga_data %>%
  select(-`Unnamed: 2`, -`Unnamed: 3`, -`Unnamed: 4`)


head(pga_data)
```

## Tour Championship Data 

Here I filtered out the tournament the "Tour Championship" from the main data frame. Then I only selected the winners so I could gain some insight about what their average metrics. The metrics that were the most important for winning the tournament were strokes gained total, strokes gained tee to green, and strokes gained off the tee.

```{r}
tour_championship <- pga_data[pga_data$`tournament name` == "Tour Championship",]
#view(tour_championship)

tour_championship =tour_championship %>% 
  group_by(season) %>% 
  slice(which.min(pos))%>%
  select(-hole_DKP, - hole_FDP, - hole_SDP, -streak_DKP, -streak_FDP, - streak_SDP, -finish_DKP, - finish_SDP, -total_DKP, -total_FDP, -total_SDP, -finish_FDP, -total_FDP)

drop_na(tour_championship[,17:22])%>%
  summarise_all(function(x)mean(x))
```


## BMW Championship Data 

Here I filtered out the tournament the "BMW Championship" from the main data frame. Then I only selected the winners so I could gain some insight about what their average metrics. The metrics that were the most important for winning the tournament were strokes gained total, strokes gained tee to green, and strokes gained putting.

```{r}
bmw_championship <- pga_data[pga_data$`tournament name` == "BMW Championship",]
#head(bmw_championship)
bmw_championship = bmw_championship %>%
  group_by(season) %>% 
  slice(which.min(pos)) %>%
  select(-hole_DKP, - hole_FDP, - hole_SDP, -streak_DKP, -streak_FDP, - streak_SDP, -finish_DKP, - finish_SDP, -total_DKP, -total_FDP, -total_SDP, -finish_FDP, -total_FDP)

drop_na(bmw_championship[,17:22])%>%
  summarise_all(function(x)mean(x))

```

## Northern Trust Data 

Here I filtered out the tournament the "Northern Trust" from the main data frame. Then I only selected the winners so I could gain some insight about what their average metrics. The metrics that were the most important for winning the tournament were strokes gained total, strokes gained tee to green, and strokes gained approach.

```{r}
north_trust <- pga_data[pga_data$`tournament name` %in% c("Northern Trust Open", "The Northern Trust"),]
drop_na(north_trust) 
#view(north_trust)
north_trust = north_trust%>% 
  group_by(season) %>% 
  slice(which.min(Finish)) %>% 
  filter(season > 2016)%>%
  select(-hole_DKP, - hole_FDP, - hole_SDP, -streak_DKP, -streak_FDP, - streak_SDP, -finish_DKP, - finish_SDP, -total_DKP, -total_FDP, -total_SDP, -finish_FDP, -total_FDP)

drop_na(north_trust[,17:22])%>%
  summarise_all(function(x)mean(x))
```

## Additional Data for Results by Season

```{r}
pga2 = read_csv("./CopyOfpgaTourData2.csv")
head(pga2)

#looking at distubution of data by year
ggplot(data = pga2, aes (x= Year))+
  geom_bar()

```

## Player's With Most Fedex Points by Season

I filtered out players who had the most Fedex Cup points in the data frame for each year. The metrics that were rated the highest for season long success were strokes gained total, strokes gained approach. 

```{r}
library(dplyr)

pga2 %>% 
  group_by(Year) %>% 
  slice(which.max(Points))

```


##Variable importance for predicting if a player wins in a given season

Here I created a basic model for determining if a player will win a tournament in a given season. The most significant indicators that were correlated with winning were points (which is fairly obvious because points are determined by how well you place in a tournament). Average score and number of top tens were also highly correlated (top tens essentially mean that a player has put themselves in more opportunities to win). Then lastly we had strokes gained total, strokes gained off the tee and scrambling (amount of times a player makes par or better when missing the fairway/green).

```{r}
library(caret)

pga3 = pga2

pga3$Wins = ifelse(is.na(pga3$Wins),0,1)

#head(pga3)

pga3 = drop_na(pga3)

colnames(pga3) <- make.names(colnames(pga3))

set.seed(504)

pga3$Wins = as.factor(pga3$Wins)

rPartMod <- train(Wins ~ ., data=pga3, method="rpart")

rpartImp <- varImp(rPartMod)

print(rpartImp)

```

## Distribution of Number of Players With and Without Wins

This chart shows the distribution of the number of players who did not win a tournament (0) and did win (1) by season. The main takeaway from this was that the seasons 2010, 2017, and 2018 had the least amount of variance. Meaning in this context that a smaller amount of players won and these players are more likely to win multiple times in these seasons.

```{r}
ggplot(data = pga3, aes (x= Wins))+
  geom_bar()+
  facet_wrap(~Year)+
  coord_flip()+
  ggtitle("Distribution of players that had 0 or 1+ wins on the PGA Tour by year")

```
